{% load static %}
<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Campus Facultad - Pasantías, Tesis e Investigaciones</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">
  <link rel="stylesheet" href="../static/home.css">
  <link rel="icon" href="../../media/Logo-Universidad-del-Cauca-vertical-1.png">
  <link rel="icon" href="../../media/Logo-Universidad-del-Cauca-vertical-1.png">
</head>

<body>


  <header style="display: flex; align-items: center; padding: 0; justify-content: space-between; height: 150px;">
    
    <div style="display: flex; align-items: center; padding: 0; gap: 10%; width: 90%;">
      <div>
        <img style="height: 150px; color: white;" src="../../media/Logo-Universidad-del-Cauca-e1715273370946.png" alt="">
      </div>
      <div class="text-center" style="background:#ffffff00; color:#fff;">
        <h1 class="mb-0">Facultad de Ingenieria Civil</h1>
        <small>Trabajos de Grado</small>
      </div>
    </div>

    <nav class="navbar navbar-expand-lg" style="background:#000066;">
      <div class="container-fluid">
        <button class="navbar-toggler text-white" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMenu">
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarMenu">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle text-white" href="#" role="button" data-bs-toggle="dropdown">
                Opciones
              </a>
              <ul class="dropdown-menu dropdown-menu-end">
                <li><a class="dropdown-item" href="{% url 'home' %}">Listado de proyectos</a></li>
                <li><a class="dropdown-item" href="{% url 'docentes' %}">Listado de profesores</a></li>
                
                {% if user.is_superuser %}
                <li><a class="dropdown-item text-primary" href="{% url 'gestionar_usuarios' %}">Gestionar Usuarios</a></li>
                {% endif %}

                <li>
                  <hr class="dropdown-divider">
                </li>
                <li><a class="dropdown-item text-danger" href="{% url 'logout' %}">Cerrar sesión</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
    </nav>
  </header>

  </header>


  <div class="container-xl">
    <div class="card shadow-lg rounded-4">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h2 class="mb-0" style="color: black;">Listado de estudiantes</h2>
          
          {% if user.is_staff or user.is_superuser %}
          <button class="btn d-flex align-items-center justify-content-center"
            style="background-color: #0d6efd; color: #fff;" data-bs-toggle="modal" data-bs-target="#addModal">
            Agregar
          </button>
          {% endif %}
        </div>
        
        <div class="table-responsive">
          <table id="datatable" class="table table-bordered table-hover align-middle" style="width:100%">
            <thead>
              <tr>
                <th>Codigo</th>
                <th>Primer apellido</th>
                <th>Segundo apellido</th>
                <th>Primer nombre</th>
                <th>Segundo nombre</th>
                <th>Facultad</th>
                <th>Programa</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              {% for estudiante in estudiantes %}
              <tr>
                <td>{{ estudiante.legajo }}</td>
                <td>{{ estudiante.primer_apellido }}</td>
                <td>{{ estudiante.segundo_apellido }}</td>
                <td>{{ estudiante.primer_nombre }}</td>
                <td>{{ estudiante.segundo_nombre }}</td>
                <td>{{ estudiante.facultad }}</td>
                <td>{{ estudiante.programa }}</td>
                <td>
                  <div class="btn-group" style="gap: 10px;">
                    <button type="button" class="btn btn-sm btn-detalle" style="background-color: #0d6efd; color: #fff; border-radius: 7px;"
                      data-id="{{ estudiante.legajo }}" data-tipo-identificacion="{{ estudiante.tipo_identificacion }}"
                      data-identificacion="{{ estudiante.identificacion }}"
                      data-primer-apellido="{{ estudiante.primer_apellido }}"
                      data-segundo-apellido="{{ estudiante.segundo_apellido }}"
                      data-primer-nombre="{{ estudiante.primer_nombre }}"
                      data-segundo-nombre="{{ estudiante.segundo_nombre }}"
                      data-correo-institucional="{{ estudiante.correo_institucional }}"
                      data-telefono="{{ estudiante.telefono }}" data-celular="{{ estudiante.celular }}"
                      data-facultad="{{ estudiante.facultad }}" data-programa="{{ estudiante.programa }}"
                      data-regionalizacion="{{ estudiante.regionalizacion }}" data-sede="{{ estudiante.sede }}">
                      DETALLE
                    </button>
                    
                    {% if user.is_staff or user.is_superuser %}
                    <button class="btn btn-modificar btn-sm" style="background-color: #ffc107; color: #fff; border-radius: 7px;"
                      data-bs-toggle="modal" data-id="{{ estudiante.legajo }}"
                      data-tipo-identificacion="{{ estudiante.tipo_identificacion }}"
                      data-identificacion="{{ estudiante.identificacion }}"
                      data-primer-apellido="{{ estudiante.primer_apellido }}"
                      data-segundo-apellido="{{ estudiante.segundo_apellido }}"
                      data-primer-nombre="{{ estudiante.primer_nombre }}"
                      data-segundo-nombre="{{ estudiante.segundo_nombre }}"
                      data-correo-institucional="{{ estudiante.correo_institucional }}"
                      data-telefono="{{ estudiante.telefono }}" data-celular="{{ estudiante.celular }}"
                      data-facultad="{{ estudiante.facultad }}" data-programa="{{ estudiante.programa }}"
                      data-regionalizacion="{{ estudiante.regionalizacion }}" data-sede="{{ estudiante.sede }}"
                      data-bs-target="#editModal">
                      MODIFICAR
                    </button>
                    <button style="border-radius: 7px;" class="btn btn-eliminar btn-sm" data-bs-toggle="modal" data-bs-target="#deleteModal"
                      data-id="{{ estudiante.legajo }}">
                      ELIMINAR
                    </button>
                    {% else %}
                      <span class="badge bg-secondary d-flex align-items-center">Solo Lectura</span>
                    {% endif %}
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>


  <div class="modal fade" id="addModal" tabindex="-1" aria-labelledby="addModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content" style="border-radius: 15px;">

        <div class="modal-header" style="background-color: #a81f17; color: #fff;">
          <h5 class="modal-title" id="addModalLabel">Agregar Nuevo Registro</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>

        <div class="modal-body">
          <form method="post" action="{% url 'agregar_estudiante' %}" autocomplete="off">
            {% csrf_token %}
            <div class="row g-3">
              <div class="col-md-4">
                <label class="form-label">Codigo</label>
                <input name="legajo" type="text" class="form-control" placeholder="Codigo del estudiante" required>
              </div>
              <div class="col-md-4">
                <label class="form-label">Tipo identificación</label>
                <select name="tipo_identificacion" class="form-select" required>
                  <option value="" selected disabled>Seleccione</option>
                  <option value="CC">CC</option>
                  <option value="TI">TI</option>
                </select>
              </div>
              <div class="col-md-4">
                <label class="form-label">Identificacion</label>
                <input name="identificacion" type="text" class="form-control" placeholder="Número de identificación" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Primer apellido</label>
                <input name="primer_apellido" type="text" class="form-control" placeholder="Primer apellido" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Segundo apellido</label>
                <input name="segundo_apellido" type="text" class="form-control" placeholder="Segundo apellido" >
              </div>
              <div class="col-md-6">
                <label class="form-label">Primer nombre</label>
                <input name="primer_nombre" type="text" class="form-control" placeholder="Primer nombre" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Segundo nombre</label>
                <input name="segundo_nombre" type="text" class="form-control" placeholder="Segundo nombre" >
              </div>
              <div class="col-md-6">
                <label class="form-label">Correo institucional</label>
                <input name="correo_institucional" type="email" class="form-control" placeholder="Correo institucional"
                  required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Teléfono</label>
                <input name="telefono" type="text" class="form-control" placeholder="Número de teléfono">
              </div>
              <div class="col-md-6">
                <label class="form-label">Celular</label>
                <input name="celular" type="text" class="form-control" placeholder="Número de celular" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Facultad</label>
                <input style="background-color: #bdbcbc; cursor: default; user-select: none; color: #494949;"
                  name="facultad" type="text" readonly class="form-control" placeholder="Ingeniería Civil" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Programa</label>
                <select name="programa" class="form-select" required>
                  <option value="" selected disabled>Seleccione</option>
                  <option value="ARQUITECTURA">Arquitectura</option>
                  <option value="GEOTECNOLOGIA">Geotecnología</option>
                  <option value="INGENIERIA AMBIENTAL">Ingeniería Ambiental</option>
                  <option value="INGENIERIA CIVIL">Ingeniería Civil</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label">Regionalización</label>
                <select name="regionalizacion" class="form-select" required>
                  <option value="" selected disabled>Seleccione</option>
                  <option value="S">SI</option>
                  <option value="N">NO</option>
                </select>
              </div>
              <div class="col-md-6">
                <label class="form-label">Sede</label>
                <select style="margin-bottom: 20px;" name="sede" class="form-control" required>
                  <option value="" selected disabled>Seleccione</option>
                  <option value="SANTANDER DE QUILICHAO">Santander de Quilichao</option>
                  <option value="POPAYAN">Popayan</option>
                </select>
              </div>
            </div>
            <div class="modal-footer" style="justify-content: center;">
              <button type="button" class="btn" data-bs-dismiss="modal"
                style="background-color: #dc3545;       color: #ffffff;">
                Cancelar
              </button>
              <button type="submit" class="btn" style="background-color: #0d6efd; color: #fff;">
                Guardar
              </button>
            </div>
          </form>
        </div>

      </div>
    </div>
  </div>


  <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content" style="border-radius: 15px;">

        <div class="modal-header" style="background-color: #a81f17; color: #fff;">
          <h5 class="modal-title" id="deleteModalLabel">Confirmar Eliminación</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>

        <div class="modal-body" style="color: #4b161f; font-size: 16px;">
          ¿Estás seguro que deseas eliminar este registro?
          <br><small class="text-muted">Esta acción no se puede deshacer.</small>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn" data-bs-dismiss="modal" style="background-color: #0d6efd; color: #ffffff;">
            Cancelar
          </button>

          <form id="deleteForm" method="post" action="">
            {% csrf_token %}
            <button type="submit" class="btn" style="background-color: #dc3545; color: #fff;">
              Confirmar
            </button>
          </form>
        </div>

      </div>
    </div>
  </div>


  <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content" style="border-radius: 15px;">

        <div class="modal-header" style="background-color: #000066; color: #fff;">
          <h5 class="modal-title" id="editModalLabel">Modificar Registro</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>

        <div class="modal-body">
          <form id="editForm" method="post" action="">
            {% csrf_token %}
            <div class="row g-3">
              <div class="col-md-4">
                <label class="form-label">Tipo identificacion</label>
                <input id="editTipo-identificacion" type="text" class="form-control" name="tipo_identificacion"
                  required>
              </div>
              <div class="col-md-4">
                <label class="form-label">Identificacion</label>
                <input id="editIdentificacion" type="text" class="form-control" name="identificacion" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Primer apellido</label>
                <input id="editPrimer-apellido" type="text" class="form-control" name="primer_apellido" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Segundo apellido</label>
                <input id="editSegundo-apellido" type="text" class="form-control" name="segundo_apellido" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Primer nombre</label>
                <input id="editPrimer-nombre" type="text" class="form-control" name="primer_nombre" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Segundo nombre</label>
                <input id="editSegundo-nombre" type="text" class="form-control" name="segundo_nombre" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Correo institucional</label>
                <input id="editCorreo-institucional" type="email" class="form-control" name="correo_institucional"
                  required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Teléfono</label>
                <input id="editTelefono" type="text" class="form-control" name="telefono" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Celular</label>
                <input id="editCelular" type="text" class="form-control" name="celular" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Facultad</label>
                <input id="editFacultad" type="text" class="form-control" name="facultad" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Programa</label>
                <input id="editPrograma" type="text" class="form-control" name="programa" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Regionalización</label>
                <input id="editRegionalizacion" type="text" class="form-control" name="regionalizacion" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Sede</label>
                <input id="editSede" type="text" class="form-control" name="sede" required>
              </div>
            </div>

            <div class="modal-footer mt-4">
              <button type="button" class="btn" data-bs-dismiss="modal"
                style="background-color: #dc3545; color: #ffffff;">
                Cancelar
              </button>
              <button type="submit" class="btn" style="background-color: #0d6efd; color: #fff;">
                Guardar cambios
              </button>
            </div>
          </form>
        </div>

      </div>
    </div>
  </div>


  <div class="modal fade" id="detalleModal" tabindex="-1" aria-labelledby="detalleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header text-white" style="background: #a81f17;">
          <h5 class="modal-title" id="detalleModalLabel">Detalle del Estudiante</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body">
          <div class="container-fluid">
            <div class="row mb-2">
              <div class="col-md-6"><strong>Legajo:</strong> <span id="detalleLegajo"></span></div>
            </div>
            <div class="row mb-2">
              <div class="col-md-6"><strong>Tipo de identificación:</strong> <span
                  id="detalleTipoIdentificacion"></span></div>
              <div class="col-md-6"><strong>Identificación:</strong> <span id="detalleIdentificacion"></span></div>
            </div>
            <div class="row mb-2">
              <div class="col-md-6"><strong>Primer apellido:</strong> <span id="detallePrimerApellido"></span></div>
              <div class="col-md-6"><strong>Segundo apellido:</strong> <span id="detalleSegundoApellido"></span></div>
            </div>
            <div class="row mb-2">
              <div class="col-md-6"><strong>Primer nombre:</strong> <span id="detallePrimerNombre"></span></div>
              <div class="col-md-6"><strong>Segundo nombre:</strong> <span id="detalleSegundoNombre"></span></div>
            </div>
            <div class="row mb-2">
              <div class="col-md-6"><strong>Correo institucional:</strong> <span id="detalleCorreo"></span></div>
              <div class="col-md-6"><strong>Teléfono:</strong> <span id="detalleTelefono"></span></div>
            </div>
            <div class="row mb-2">
              <div class="col-md-6"><strong>Celular:</strong> <span id="detalleCelular"></span></div>
            </div>
            <div class="row mb-2">
              <div class="col-md-6"><strong>Facultad:</strong> <span id="detalleFacultad"></span></div>
              <div class="col-md-6"><strong>Programa:</strong> <span id="detallePrograma"></span></div>
            </div>
            <div class="row mb-2">
              <div class="col-md-6"><strong>Regionalización:</strong> <span id="detalleRegionalizacion"></span></div>
              <div class="col-md-6"><strong>Sede:</strong> <span id="detalleSede"></span></div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
        </div>
      </div>
    </div>
  </div>



  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
  <script src="../static/js/home.js"></script>
  <script src="../static/js/estudiantes.js" ></script>
</body>
</html>